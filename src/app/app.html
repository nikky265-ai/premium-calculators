<div class="container">
  <h1>{{ title }}</h1>

  <form [formGroup]="form" (ngSubmit)="calculate()" novalidate>
    <div class="row">
      <label for="name">Name</label>
      <input id="name" type="text" formControlName="name" placeholder="Enter full name">
      <small class="error" *ngIf="showFieldError('name')">Name is required.</small>
    </div>

    <div class="row two-col">
      <div>
        <label for="ageNextBirthday">Age Next Birthday</label>
        <input id="ageNextBirthday" type="number" formControlName="ageNextBirthday" placeholder="e.g. 35">
        <small class="hint">Required if DOB is empty.</small>
        <small class="error" *ngIf="showFieldError('ageNextBirthday')">Age must be 1–120.</small>
      </div>
      <div>
        <label for="dateOfBirth">Date of Birth</label>
        <input id="dateOfBirth" type="date" formControlName="dateOfBirth">
        <small class="hint">Required if Age Next Birthday is empty.</small>
      </div>
    </div>
    <small class="error" *ngIf="form.errors?.['oneOfRequired']">
      Either Age Next Birthday or Date of Birth is required.
    </small>

    <div class="row">
      <label for="occupationCode">Occupation</label>
      <select id="occupationCode" formControlName="occupationCode">
        <option value="" disabled selected>Select occupation</option>
        <option *ngFor="let o of occupations() ?? []" [value]="o.code">
          {{ o.name }} ({{ o.rating }}, factor: {{ o.factor }})
        </option>
      </select>
      <small class="error" *ngIf="showFieldError('occupationCode')">Occupation is required.</small>
      <small *ngIf="loadingOccupations()">Loading occupations…</small>
    </div>

    <div class="row">
      <label for="deathSumInsured">Death Sum Insured</label>
      <input id="deathSumInsured" type="number" formControlName="deathSumInsured" placeholder="e.g. 500000">
      <small class="error" *ngIf="showFieldError('deathSumInsured')">Enter a positive amount.</small>
    </div>

    <div class="row actions">
      <label class="toggle">
        <input type="checkbox" [checked]="autoCalculate()" (change)="autoCalculate.set($event.target.checked)">
        Auto-calculate when form is valid
      </label>

      <button type="submit" [disabled]="form.invalid || loadingPremium()">Calculate Premium</button>
    </div>
  </form>

  <div class="result" *ngIf="result() as r">
    <h2>Result</h2>
    <div class="card">
      <div><strong>Monthly Premium:</strong> {{ r.monthlyPremium | number:'1.2-2' }}</div>
      <div><strong>Age Used:</strong> {{ r.ageUsed }}</div>
      <div><strong>Occupation:</strong> {{ r.occupation }}</div>
      <div><strong>Rating Factor:</strong> {{ r.ratingFactor }}</div>
      <div><strong>Formula:</strong> {{ r.formula }}</div>
    </div>
  </div>

  <div class="error-banner" *ngIf="error()">
    {{ error() }}
  </div>
</div>
